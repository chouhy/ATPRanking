<html lang="en"><head>

<meta charset="UTF-8">

<title>Animation</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    

  
<style>
html,body{
    background-color: black;
}
.rankTags{
    left:0;
    position: absolute;
    color: white;
}
.bar {
    left:3.5%;
    display: block;
    position: absolute;
    background: inherit;
    width:60%;
    height:5%;

}

.bar .bar-inner{
    height: 100%;
    display: inline-block;
    background-color: blue;
    padding-top: 1.1%;
    padding-left: 2%;
    color: white;
} 
.pic{
    position:absolute;
    max-height: 90%;
    left: 65%;
    color: white;
    text-shadow:  1px 0 black;
    font-weight: bold;
}
.name{
    text-shadow:  1px 0 black;
    font-weight: bold;
}
.age{
    text-shadow: 1px 0 black;
    font-weight: bold;
}
.bar .point{
    color: white;
    vertical-align: top;
}
.bar.out{
    display: none;
}
.bar .bar-inner.no1{
    background-color: red;
}
.bar .bar-inner.no2{
    background-color: red;
}
.bar .bar-inner.no3{
    background-color: red;
}
.bar .bar-inner.no4{
    background-color: red;
}
.bar .bar-inner.no5{
    background-color: orange;
}
.bar .bar-inner.no6{
    background-color: orange;
}
.bar .bar-inner.no7{
    background-color: orange;
}
.bar .bar-inner.no8{
    background-color: green;
}
.bar .bar-inner.no9{
    background-color: green;
}
.bar .bar-inner.no10{
    background-color: green;
}
</style>

</head>

<body>
    <div class="bar no1"  style=" top:7%;" >
        <span class="bar-inner" style="width:50%;">
        <img height="90%" align="top" src="" onerror="$(this).hide()">
            <span class="name"></span><span class="age"></span></span><span class="point">111</span>
    </div>
    <div class="bar no2" style=" top:15%;" >
        <span class="bar-inner" style="width:50%;">
        <img height="90%" align="top" src="" onerror="$(this).hide()">
            <span class="name"></span><span class="age"></span></span><span class="point">111</span>
    </div>
    <div class="bar no3" style=" top:23%;">
        <span class="bar-inner" style="width:50%;">
        <img height="90%" align="top" src="" onerror="$(this).hide()">
            <span class="name"></span><span class="age"></span></span><span class="point">111</span>
    </div>
    <div class="bar no4" style=" top:31%;">
        <span class="bar-inner" style="width:50%;">
        <img height="90%" align="top" src="" onerror="$(this).hide()">
        <span class="name"></span><span class="age"></span></span><span class="point">111</span>
    </div>
    <div class="bar no5" style=" top:39%;">
        <span class="bar-inner" style="width:50%;">
        <img height="90%" align="top" src="" onerror="$(this).hide()">
        <span class="name"></span><span class="age"></span></span><span class="point">111</span>
    </div>
    <div class="bar no6" style=" top:47%;">
        <span class="bar-inner" style="width:50%;">
        <img height="90%" align="top" src="" onerror="$(this).hide()">
        <span class="name"></span><span class="age"></span></span><span class="point">111</span>
    </div>
    <div class="bar no7" style=" top:55%;">
        <span class="bar-inner" style="width:50%;">
        <img height="90%" align="top" src="" onerror="$(this).hide()">
        <span class="name"></span><span class="age"></span></span><span class="point">111</span>
    </div>
    <div class="bar no8" style=" top:63%;">
        <span class="bar-inner" style="width:50%;">
        <img height="90%" align="top" src="" onerror="$(this).hide()">
        <span class="name"></span><span class="age"></span></span><span class="point">111</span>
    </div>
    <div class="bar no9" style=" top:71%;">
        <span class="bar-inner" style="width:50%;">
        <img height="90%" align="top" src="" onerror="$(this).hide()">
        <span class="name"></span><span class="age"></span></span><span class="point">111</span>
    </div>
    <div class="bar no10" style=" top:79%;">
        <span class="bar-inner" style="width:50%;">
        <img height="90%" align="top" src="" onerror="$(this).hide()">
        <span class="name"></span><span class="age"></span></span><span class="point">111</span>
    </div>


    <div class="bar out" style="  top:87%;">
        <span class="bar-inner" style="width:50%;">
        <img height="90%" align="top" src="" onerror="$(this).hide()">
        <span class="name"></span><span class="age"></span></span><span class="point">111</span>
    </div>
    <div class="bar out" style="  top:87%;">
        <span class="bar-inner" style="width:50%;">
        <img height="90%" align="top" src="" onerror="$(this).hide()">
        <span class="name"></span><span class="age"></span></span><span class="point">111</span>
    </div>
    <div class="bar out" style="  top:87%;">
        <span class="bar-inner" style="width:50%;">
        <img height="90%" align="top" src="" onerror="$(this).hide()">
        <span class="name"></span><span class="age"></span></span><span class="point">111</span>
    </div>
    <div class="bar out" style="  top:87%;">
        <span class="bar-inner" style="width:50%;">
        <img height="90%" align="top" src="" onerror="$(this).hide()">
        <span class="name"></span><span class="age"></span></span><span class="point">111</span>
    </div>
    <div class="bar out" style="  top:87%;">
        <span class="bar-inner" style="width:50%;">
        <img height="90%" align="top" src="" onerror="$(this).hide()">
        <span class="name"></span><span class="age"></span></span><span class="point">111</span>
    </div>

    <div class="rankTags" style=" top:9%;" >NO.1</div>
    <div class="rankTags" style=" top:17%;" >NO.2</div>
    <div class="rankTags" style=" top:25%;" >NO.3</div>
    <div class="rankTags" style=" top:33%;" >NO.4</div>
    <div class="rankTags" style=" top:41%;" >NO.5</div>
    <div class="rankTags" style=" top:49%;" >NO.6</div>
    <div class="rankTags" style=" top:57%;" >NO.7</div>
    <div class="rankTags" style=" top:65%;" >NO.8</div>
    <div class="rankTags" style=" top:73%;" >NO.9</div>
    <div class="rankTags" style=" top:81%;" >NO.10</div>

    <div><button id="click" >click</button><button id="auto" >auto</button> <span id='date' style="color: white">date</span></div>
<div id="num1s" ></div>
    <div class="pic" style="display: none;"><span id ="picName"></span> 連續:<span id="consecWeek"></span><br><img id="number1Pic"  align="right" height="90%" src=""></div>

  

<script>
var flag ='https://www.atpworldtour.com/en/~/media/images/flags/';
var num1s=[];
var color = ["#ff66ff","#ff0000","#0066cc","#009933",
            "#3333ff","#ff6600","#ffb31a","#a64dff",
            "#ff1a1a","#004280","#ff5500","#ff3300",
            "#53c68c","#40bf40","#0066ff","#ff4000"
            ];
var rank,max;
var cur = 0; 
$.get("./data/ATPRankingHistory",function(data,status){
        rank = data.split('\n');
        max = rank.length -1;
});
var maxPoint;
var map = [0,'no1','no2','no3','no4','no5','no6','no7','no8','no9','no10'];
var position = {no1:7,no2:15,no3:23,no4:31,no5:39,no6:47,no7:55,no8:63,no9:71,no10:79};
function reorder(){
    $.each($(".bar"),function(){
        var order = map[$(this).attr("rank")];
        if($(this).hasClass("top")){
            
            //$("#click").text($("#click").text()+order);
            if($(this).css("top") != position[order]+"%")
                $(this).animate({top:position[order]+"%"},200);
            $(this).show(0);

        }

        else{
            $(this).animate({"top":"87%"},200);
            $(this).attr("value","");
            $(this).find("span").first().removeClass(order);
            $(this).addClass("out");
            $(this).fadeOut(200);
        }
    });
    $(".top").removeClass("top");
}
function update(raw){

    var info = raw.split('+');
    if(info[0] == 1) maxPoint= 2500 + parseInt(info[4]);
    if(info[0] == 1){
        if($("#number1Pic").attr("src") == "./number1s/"+info[2].replace(/\s+/g,'')+".png"){
            var week = parseInt($("#consecWeek").text());
            $("#consecWeek").text(week+1);
        }
        else {
            $("#number1Pic").attr("src","./number1s/"+info[2].replace(/\s+/g,'')+".png");
            $("#picName").text(info[2]);
            $("#consecWeek").text("1");
        }
        if(num1s.indexOf(info[2]) == -1)
            num1s.push(info[2]);
    }
    //info[1] = country
    //info[2] = player name
    //info[3] = age
    //info[4] = point
    var player = $("[value =\""+info[2]+"\" ]");
    //console.log(info[1]);
    if(player.length == 0){
        //new top10
        var newPlayer = $(".bar.out").first();
        newPlayer.find("span").first().css({"width":(info[4]/maxPoint *60 +40)+"%","background-color":color[Math.floor(Math.random() * 16)]});
        newPlayer.attr("value",info[2]);
        newPlayer.attr("rank",info[0]);
        newPlayer.find(".name").text(info[2]);
        newPlayer.find(".age").text("("+info[3]+")");
        newPlayer.find(".point").text(info[4]);
        newPlayer.find("img").attr("src",flag+info[1]+".svg").show();
        newPlayer.addClass("top");
        newPlayer.css("opacity",0).show().animate({"opacity":1},50);
        newPlayer.removeClass("out");
        
    }
    else{
        player.find("span").first().animate({'width':(info[4]/maxPoint *60 +40)+"%"},250);
        player.find("span").first().removeClass(map[player.attr("rank")]);
        player.attr("value",info[2]);
        player.attr("rank",info[0]);
        player.find(".name").text(info[2]);
        player.find(".age").text("("+info[3]+")");
        player.find(".point").text(info[4]);
        player.addClass("top");
    }
}
function setup(raw){
    var info = raw.split('+');
    if(info[0] == 1) {
        maxPoint= 2500 + parseInt(info[4]);
        $("#number1Pic").attr("src","./number1s/"+info[2].replace(/\s+/g,'')+".png");
        $(".pic").show();
        $("#picName").text(info[2]);
        $("#consecWeek").text("1");
    }
    var t = $("."+map[info[0]]);
    t.find("span").first().animate({'width':(info[4]/maxPoint *60 +40)+"%"},250).css("background-color",color[Math.floor(Math.random() * 16)]);
    t.find("img").attr("src",flag+info[1]+".svg").show();
    t.attr("value",info[2]);
    t.attr("rank",info[0]);
    t.find(".name").text(info[2]);
    t.find(".age").text("("+info[3]+")");
    t.find(".point").text(info[4]);
    //t.removeClass(map[info[0]]);


}
$(document).ready(function(){
    $("#click").hide();
    $("#auto").click(function(){
        $("#click").hide();
        var timer;
        timer = setInterval(function(){if(cur < max) $("#click").click(); else clearInterval(timer);},500);
    });
    $("#click").click(function(){
        $("#auto").hide();
        detail = rank[cur].split(',');
        $("#date").text(detail[0]);
        for(var i = 1; i < 11;i++){
            if (cur == 0)  setup(detail[i]);
            else {
                //console.log(i);
                update(detail[i]);
            }
        }
        if(cur != 0) reorder();
        cur ++;
        //cur = cur % max;
        
    });
});

</script>
</body></html>