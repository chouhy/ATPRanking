<html lang="en"><head>

<meta charset="UTF-8">

<title>Animation</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    

  
<style>
html,body{
    background-color: black;
    font-size: 1.2vw;
}
.topline{
    max-height: 6vh;
}
.rankTags{
    left:0;
    max-width: 3vw;
    position: absolute;
    color: white;
    display: none;
}
.bar {
    left:3.5vw;
    display: flex;
    position: absolute;
    align-items: center;
    width:50vw;
    height:7vh;

}

.bar .bar-inner{
    display: inline-flex;
    height: 100%;
    align-items: center;
    color: white;
} 
.bar .bar-inner img{
    padding-top: 1%;
    padding-left: 1%;
    padding-bottom: 1%;
}
.pic{
    position:absolute;
    height: 90vh;
    width: 35vw;
    left: 60vw;
    color: white;
    text-shadow:  0.1vw 0 black;
    font-weight: bold;
}
.name{
    text-shadow:  0.1vw 0 black;
    font-weight: bold;
}
.age{
    text-shadow: 0.1vw 0 black;
    font-weight: bold;
}
.bar .point{
    color: white;
    vertical-align: center;
}
.bar .bar-inner.no1{
    background-color: red;
}
.bar .bar-inner.no2{
    background-color: red;
}
.bar .bar-inner.no3{
    background-color: red;
}
.bar .bar-inner.no4{
    background-color: red;
}
.bar .bar-inner.no5{
    background-color: orange;
}
.bar .bar-inner.no6{
    background-color: orange;
}
.bar .bar-inner.no7{
    background-color: orange;
}
.bar .bar-inner.no8{
    background-color: green;
}
.bar .bar-inner.no9{
    background-color: green;
}
.bar .bar-inner.no10{
    background-color: green;
}
</style>

</head>

<body>
    <div class="bar no1"  style=" top:7vh;" >
        <span class="bar-inner" style="width:50%;">
        <img height="70%" align="top" src="" style="display:none">
            <span class="name"></span><span class="age"></span></span><span class="point"></span>
    </div>
    <div class="bar no2" style=" top:15vh;" >
        <span class="bar-inner" style="width:50%;">
        <img height="70%" align="top" src="" style="display:none">
            <span class="name"></span><span class="age"></span></span><span class="point"></span>
    </div>
    <div class="bar no3" style=" top:23vh;">
        <span class="bar-inner" style="width:50%;">
        <img height="70%" align="top" src="" style="display:none">
            <span class="name"></span><span class="age"></span></span><span class="point"></span>
    </div>
    <div class="bar no4" style=" top:31vh;">
        <span class="bar-inner" style="width:50%;">
        <img height="70%" align="top" src="" style="display:none">
        <span class="name"></span><span class="age"></span></span><span class="point"></span>
    </div>
    <div class="bar no5" style=" top:39vh;">
        <span class="bar-inner" style="width:50%;">
        <img height="70%" align="top" src="" style="display:none">
        <span class="name"></span><span class="age"></span></span><span class="point"></span>
    </div>
    <div class="bar no6" style=" top:47vh;">
        <span class="bar-inner" style="width:50%;">
        <img height="70%" align="top" src="" style="display:none">
        <span class="name"></span><span class="age"></span></span><span class="point"></span>
    </div>
    <div class="bar no7" style=" top:55vh;">
        <span class="bar-inner" style="width:50%;">
        <img height="70%" align="top" src="" style="display:none">
        <span class="name"></span><span class="age"></span></span><span class="point"></span>
    </div>
    <div class="bar no8" style=" top:63vh;">
        <span class="bar-inner" style="width:50%;">
        <img height="70%" align="top" src="" style="display:none">
        <span class="name"></span><span class="age"></span></span><span class="point"></span>
    </div>
    <div class="bar no9" style=" top:71vh;">
        <span class="bar-inner" style="width:50%;">
        <img height="70%" align="top" src="" style="display:none">
        <span class="name"></span><span class="age"></span></span><span class="point"></span>
    </div>
    <div class="bar no10" style=" top:79vh;">
        <span class="bar-inner" style="width:50%;">
        <img height="70%" align="top" src="" style="display:none">
        <span class="name"></span><span class="age"></span></span><span class="point"></span>
    </div>


    <div class="bar out" style="  top:87%;">
        <span class="bar-inner" style="width:50%;">
        <img height="70%" align="top" src="" style="display:none">
        <span class="name"></span><span class="age"></span></span><span class="point"></span>
    </div>
    <div class="bar out" style="  top:87%;">
        <span class="bar-inner" style="width:50%;">
        <img height="70%" align="top" src="" style="display:none">
        <span class="name"></span><span class="age"></span></span><span class="point"></span>
    </div>
    <div class="bar out" style="  top:87%;">
        <span class="bar-inner" style="width:50%;">
        <img height="70%" align="top" src="" style="display:none">
        <span class="name"></span><span class="age"></span></span><span class="point"></span>
    </div>
    <div class="bar out" style="  top:87%;">
        <span class="bar-inner" style="width:50%;">
        <img height="70%" align="top" src="" style="display:none">
        <span class="name"></span><span class="age"></span></span><span class="point"></span>
    </div>
    <div class="bar out" style="  top:87%;">
        <span class="bar-inner" style="width:50%;">
        <img height="70%" align="top" src="" style="display:none">
        <span class="name"></span><span class="age"></span></span><span class="point"></span>
    </div>
    <div class="bar out" style="  top:87%;">
        <span class="bar-inner" style="width:50%;">
        <img height="70%" align="top" src="" style="display:none">
        <span class="name"></span><span class="age"></span></span><span class="point"></span>
    </div>
    <div class="bar out" style="  top:87%;">
        <span class="bar-inner" style="width:50%;">
        <img height="70%" align="top" src="" style="display:none">
        <span class="name"></span><span class="age"></span></span><span class="point"></span>
    </div>
    <div class="bar out" style="  top:87%;">
        <span class="bar-inner" style="width:50%;">
        <img height="70%" align="top" src="" style="display:none">
        <span class="name"></span><span class="age"></span></span><span class="point"></span>
    </div>
    <div class="bar out" style="  top:87%;">
        <span class="bar-inner" style="width:50%;">
        <img height="70%" align="top" src="" style="display:none">
        <span class="name"></span><span class="age"></span></span><span class="point"></span>
    </div>
    <div class="bar out" style="  top:87%;">
        <span class="bar-inner" style="width:50%;">
        <img height="70%" align="top" src="" style="display:none">
        <span class="name"></span><span class="age"></span></span><span class="point"></span>
    </div>

    <div class="rankTags" style=" top:9vh;" >NO.1</div>
    <div class="rankTags" style=" top:17vh;" >NO.2</div>
    <div class="rankTags" style=" top:25vh;" >NO.3</div>
    <div class="rankTags" style=" top:33vh;" >NO.4</div>
    <div class="rankTags" style=" top:41vh;" >NO.5</div>
    <div class="rankTags" style=" top:49vh;" >NO.6</div>
    <div class="rankTags" style=" top:57vh;" >NO.7</div>
    <div class="rankTags" style=" top:65vh;" >NO.8</div>
    <div class="rankTags" style=" top:73vh;" >NO.9</div>
    <div class="rankTags" style=" top:81vh;" >NO.10</div>

    <div class="topline"><button id="next" style="font-size: 1.2vw" >Next</button>
        <button id="prev" style="font-size: 1.2vw" >Prev</button>
        <button id="auto" style="font-size: 1.2vw" >auto/stop</button>
        <button id="firstPoint" style="font-size: 1.2vw" >first week with points</button>
        <button id="addYear" style="font-size: 1.2vw" >+52</button>
        <button id="minusYear" style="font-size: 1.2vw" >-52</button>
        <button id="big4" style="font-size: 1.2vw" >first big4 in top4</button>
         <span id='date' style="color: white;"></span></div>
<div id="num1s" ></div>
    <div class="pic" style="display: none;"><span id ="picName"></span> .consecutive:<span id="consecWeek"></span><br><img id="number1Pic"  height="90%" src=""></div>

  

<script>
$("button").attr("disabled",true);
var isSet=0;
var isAuto=0;
var flag ='https://www.atpworldtour.com/en/~/media/images/flags/';
var num1s=['IlieNastase','JohnNewcombe','JimmyConnors','BjornBorg',
'JohnMcEnroe','IvanLendl','MatsWilander','StefanEdberg',
'BorisBecker','JimCourier','PeteSampras','AndreAgassi',
'ThomasMuster','MarceloRios','CarlosMoya','YevgenyKafelnikov',
'PatrickRafter','MaratSafin','GustavoKuerten','LleytonHewitt',
'JuanCarlosFerrero','AndyRoddick','RogerFederer','RafaelNadal',
'NovakDjokovic','AndyMurray'];
var color = ["#ff66ff","#ff0000","#0066cc","#009933",
            "#3333ff","#ff6600","#ffb31a","#a64dff",
            "#ff1a1a","#004280","#ff5500","#ff3300",
            "#53c68c","#40bf40","#0066ff","#ff4000"
            ];
var rank,max;
var cur = -1; 
$.get("./data/ATPRankingHistory",function(data,status){
        rank = data.split('\n');
        max = rank.length -2;
});
for (var i = 0; i < num1s.length;i++){
    tempImg = new Image();
    tempImg.src = "./number1s/"+num1s[i]+".png";
}
var maxPoint;
var map = [0,'no1','no2','no3','no4','no5','no6','no7','no8','no9','no10'];
var position = {no1:7,no2:15,no3:23,no4:31,no5:39,no6:47,no7:55,no8:63,no9:71,no10:79};
function reorder(){
    $.each($(".bar"),function(){
        var order = map[$(this).attr("rank")];
        if($(this).hasClass("top")){
            
            //$("#click").text($("#click").text()+order);
            if($(this).css("top") != position[order]+"vh")
                $(this).animate({top:position[order]+"vh"},200);
            $(this).show(0);

        }

        else{
            $(this).animate({"top":"87%"},200);
            $(this).attr("value","");
            // $(this).find("span").first().removeClass(order);
            $(this).addClass("out");
            $(this).fadeOut(200);
        }
    });
    $(".top").removeClass("top");
}
function update(raw){

    var info = raw.split('+');
    if(info[0] == 1) maxPoint= 900 + parseInt(info[4]);
    if(info[0] == 1){
        if($("#number1Pic").attr("src") == "./number1s/"+info[2].replace(/\s+/g,'')+".png"){
            var week = parseInt($("#consecWeek").text());
            $("#consecWeek").text(week+1);
        }
        else {
            $("#number1Pic").attr("src","./number1s/"+info[2].replace(/\s+/g,'')+".png");
            $("#picName").text(info[2]);
            $("#consecWeek").text("1");
        }
    }
    //info[1] = country
    //info[2] = player name
    //info[3] = age
    //info[4] = point
    var player = $("[value =\""+info[2]+"\" ]");
    //console.log(info[1]);
    if(player.length == 0){
        //new top10
        var newPlayer = $(".bar.out").first();
        newPlayer.find("span").first().css({"width":(info[4]/maxPoint *60 +40)+"%","background-color":color[Math.floor(Math.random() * 16)]});
        newPlayer.attr("value",info[2]);
        newPlayer.attr("rank",info[0]);
        newPlayer.find(".name").text(info[2]);
        newPlayer.find(".age").text("("+info[3]+")");
        newPlayer.find(".point").text(info[4]);
        newPlayer.find("img").attr("src",flag+info[1]+".svg").show();
        newPlayer.addClass("top");
        newPlayer.css("opacity",0).show().animate({"opacity":1},50);
        newPlayer.removeClass("out");
        
    }
    else{
        player.find("span").first().animate({'width':(info[4]/maxPoint *60 +40)+"%"},250);
        player.find("span").first().removeClass(map[player.attr("rank")]);
        player.attr("value",info[2]);
        player.attr("rank",info[0]);
        player.find(".name").text(info[2]);
        player.find(".age").text("("+info[3]+")");
        player.find(".point").text(info[4]);
        player.addClass("top");
    }
}
function setup(raw){

    $(".rankTags").show();
    var info = raw.split('+');
    if(info[0] == 1) {
        maxPoint= 900 + parseInt(info[4]);
        $("#number1Pic").attr("src","./number1s/"+info[2].replace(/\s+/g,'')+".png");
        $(".pic").show();
        $("#picName").text(info[2]);
        $("#consecWeek").text("1");
    }
    var t = $("."+map[info[0]]);
    t.find("span").first().animate({'width':(info[4]/maxPoint *60 +40)+"%"},250).css("background-color",color[Math.floor(Math.random() * 16)]);
    t.find("img").attr("src",flag+info[1]+".svg").show();
    t.attr("value",info[2]);
    t.attr("rank",info[0]);
    t.find(".name").text(info[2]);
    t.find(".age").text("("+info[3]+")");
    t.find(".point").text(info[4]);
    //t.removeClass(map[info[0]]);


}
function setCurrentBar(index=0){
    var detail = rank[index].split(',');
    $("#date").text(detail[0]);
    for(var i = 1; i < 11;i++){
        if (isSet == 0) {
            setup(detail[i]);
        }
        else {
            //console.log(i);
            update(detail[i]);
        }
    }
    if(isSet != 0) reorder();
    isSet = 1;
}
$(document).ready(function(){
    //$("#click").hide();
    $("button").attr("disabled",false);
    $("#auto").click(function(){
        $("button").not("#auto").attr("disabled",true);
        isAuto = (isAuto+1)%2;
        //$("#click").hide();
        var timer;
        timer = setInterval(function(){
            if(cur < max && isAuto == 1){
                setCurrentBar(++cur); 
            }
            else {
                clearInterval(timer);
                $("button").attr("disabled",false);
            }
        },500);
    });
    $("#next").click(function(){
        // $("#auto").hide();
        $("button").attr("disabled",true);
        if(cur < max)
            setCurrentBar(++cur);
        setTimeout("$(\"button\").attr(\"disabled\",false);",500);
        //cur = cur % max;
        
    });
    $("#prev").click(function(){
        $("button").attr("disabled",true);
        cur--;
        if(cur <= 0) cur = 0;
        setCurrentBar(cur);
        setTimeout("$(\"button\").attr(\"disabled\",false);",500);
    });
    $("#addYear").click(function(){
        $("button").attr("disabled",true);
        cur += 52;
        if(cur > max) cur = max;
        setCurrentBar(cur);
        setTimeout("$(\"button\").attr(\"disabled\",false);",500);
    });
    $("#minusYear").click(function(){
        $("button").attr("disabled",true);
        cur -= 52;
        if(cur <= 0 ) cur = 0;
        setCurrentBar(cur);
        setTimeout("$(\"button\").attr(\"disabled\",false);",500);
    });
    $("#firstPoint").click(function(){
        $("button").attr("disabled",true);
        cur = 709;
        setCurrentBar(cur);
        setTimeout("$(\"button\").attr(\"disabled\",false);",500);
    });
    $("#big4").click(function(){
        $("button").attr("disabled",true);
        cur = 1337;
        setCurrentBar(cur);
        setTimeout("$(\"button\").attr(\"disabled\",false);",500);
    });
});

</script>
</body></html>