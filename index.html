<html lang="en"><head>

<meta charset="UTF-8">

<title>Animation</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    

  
<style>
html,body{
    background-color: black;
}
.rankTags{
    left:0;
    position: absolute;
    color: white;
}
.bar {
    left:3.5%;
    display: block;
    position: absolute;
    background: inherit;
    width:50%;
    height:5%;

}

.bar .bar-inner{
    height: 100%;
    display: inline-block;
    background-color: blue;
    padding-top: 1.1%;
    padding-left: 2%;
    color: white;
} 
.name{
    text-shadow:  1px 0 black;
    font-weight: bold;
}
.age{
    text-shadow: 1px 0 black;
    font-weight: bold;
}
.bar .point{
    color: white;
    vertical-align: top;
}
.bar.out{
    display: none;
}
.bar .bar-inner.no1{
    background-color: red;
}
.bar .bar-inner.no2{
    background-color: red;
}
.bar .bar-inner.no3{
    background-color: red;
}
.bar .bar-inner.no4{
    background-color: red;
}
.bar .bar-inner.no5{
    background-color: orange;
}
.bar .bar-inner.no6{
    background-color: orange;
}
.bar .bar-inner.no7{
    background-color: orange;
}
.bar .bar-inner.no8{
    background-color: green;
}
.bar .bar-inner.no9{
    background-color: green;
}
.bar .bar-inner.no10{
    background-color: green;
}
</style>

</head>

<body>
    <div class="bar no1"  style=" top:7%;" >
        <span class="bar-inner" style="width:50%;"><span class="name"></span><span class="age"></span></span><span class="point">111</span>
    </div>
    <div class="bar no2" style=" top:15%;" >
        <span class="bar-inner" style="width:50%;"><span class="name"></span><span class="age"></span></span><span class="point">111</span>
    </div>
    <div class="bar no3" style=" top:23%;">
        <span class="bar-inner" style="width:50%;"><span class="name"></span><span class="age"></span></span><span class="point">111</span>
    </div>
    <div class="bar no4" style=" top:31%;">
        <span class="bar-inner" style="width:50%;"><span class="name"></span><span class="age"></span></span><span class="point">111</span>
    </div>
    <div class="bar no5" style=" top:39%;">
        <span class="bar-inner" style="width:50%;"><span class="name"></span><span class="age"></span></span><span class="point">111</span>
    </div>
    <div class="bar no6" style=" top:47%;">
        <span class="bar-inner" style="width:50%;"><span class="name"></span><span class="age"></span></span><span class="point">111</span>
    </div>
    <div class="bar no7" style=" top:55%;">
        <span class="bar-inner" style="width:50%;"><span class="name"></span><span class="age"></span></span><span class="point">111</span>
    </div>
    <div class="bar no8" style=" top:63%;">
        <span class="bar-inner" style="width:50%;"><span class="name"></span><span class="age"></span></span><span class="point">111</span>
    </div>
    <div class="bar no9" style=" top:71%;">
        <span class="bar-inner" style="width:50%;"><span class="name"></span><span class="age"></span></span><span class="point">111</span>
    </div>
    <div class="bar no10" style=" top:79%;">
        <span class="bar-inner" style="width:50%;"><span class="name"></span><span class="age"></span></span><span class="point">111</span>
    </div>


    <div class="bar out" style="  top:87%;">
        <span class="bar-inner" style="width:50%;"><span class="name"></span><span class="age"></span></span><span class="point">111</span>
    </div>
    <div class="bar out" style="  top:87%;">
        <span class="bar-inner" style="width:50%;"><span class="name"></span><span class="age"></span></span><span class="point">111</span>
    </div>
    <div class="bar out" style="  top:87%;">
        <span class="bar-inner" style="width:50%;"><span class="name"></span><span class="age"></span></span><span class="point">111</span>
    </div>
    <div class="bar out" style="  top:87%;">
        <span class="bar-inner" style="width:50%;"><span class="name"></span><span class="age"></span></span><span class="point">111</span>
    </div>
    <div class="bar out" style="  top:87%;">
        <span class="bar-inner" style="width:50%;"><span class="name"></span><span class="age"></span></span><span class="point">111</span>
    </div>

    <div class="rankTags" style=" top:8%;" >NO.1</div>
    <div class="rankTags" style=" top:16%;" >NO.2</div>
    <div class="rankTags" style=" top:24%;" >NO.3</div>
    <div class="rankTags" style=" top:32%;" >NO.4</div>
    <div class="rankTags" style=" top:40%;" >NO.5</div>
    <div class="rankTags" style=" top:48%;" >NO.6</div>
    <div class="rankTags" style=" top:56%;" >NO.7</div>
    <div class="rankTags" style=" top:64%;" >NO.8</div>
    <div class="rankTags" style=" top:72%;" >NO.9</div>
    <div class="rankTags" style=" top:80%;" >NO.10</div>

    <div><button id="click" >click</button><button id="auto" >auto</button> <span id='date' style="color: white">date</span></div>


  

<script>
var color = ["#ff66ff","#ff0000","#0066cc","#009933",
            "#3333ff","#ff6600","#73e600","#a64dff",
            "#ff1a1a","#004280","#ff5500","#ff3300",
            "#53c68c","#40bf40","#0066ff","#ff4000"
            ];
var rank,max;
var cur = 0; 
$.get("./data/ATPRankingHistory",function(data,status){
        rank = data.split('\n');
        max = rank.length -1;
});
var maxPoint;
var map = [0,'no1','no2','no3','no4','no5','no6','no7','no8','no9','no10'];
var position = {no1:7,no2:15,no3:23,no4:31,no5:39,no6:47,no7:55,no8:63,no9:71,no10:79};
function reorder(){
    $.each($(".bar"),function(){
        var order = map[$(this).attr("rank")];
        if($(this).hasClass("top")){
            
            //$("#click").text($("#click").text()+order);
            
            $(this).animate({top:position[order]+"%"},250);

        }

        else{
            $(this).animate({"top":"87%"},250);
            $(this).attr("value","");
            $(this).find("span").first().removeClass(order);
            $(this).addClass("out");
            $(this).fadeOut(200);
        }
    });
    $(".top").removeClass("top");
}
function update(raw){
    var info = raw.split('+');
    if(info[0] == 1) maxPoint= 2500 + parseInt(info[3]);

    //info[1] = player name
    //info[2] = age
    //info[3] = point
    var player = $("[value =\""+info[1]+"\" ]");
    //console.log(info[1]);
    if(player.length == 0){
        //new top10
        var newPlayer = $(".bar.out").first();
        newPlayer.find("span").first().css({"width":(info[3]/maxPoint *75 +25)+"%","background-color":color[Math.floor(Math.random() * 16)]});
        newPlayer.attr("value",info[1]);
        newPlayer.attr("rank",info[0]);
        newPlayer.find(".name").text(info[1]);
        newPlayer.find(".age").text("("+info[2]+")");
        newPlayer.find(".point").text(info[3]);
        newPlayer.addClass("top");
        newPlayer.show();
        newPlayer.removeClass("out");
        
    }
    else{
        player.find("span").first().animate({'width':(info[3]/maxPoint *75 +25)+"%"},250);
        player.find("span").first().removeClass(map[player.attr("rank")]);
        player.attr("value",info[1]);
        player.attr("rank",info[0]);
        player.find(".name").text(info[1]);
        player.find(".age").text("("+info[2]+")");
        player.find(".point").text(info[3]);
        player.addClass("top");
    }
    
}
function setup(raw){
    var info = raw.split('+');
    if(info[0] == 1) maxPoint= 2500 + parseInt(info[3]);
    var t = $("."+map[info[0]]);
    t.find("span").first().animate({'width':(info[3]/maxPoint *75 +25)+"%"},250).css("background-color",color[Math.floor(Math.random() * 16)]);

    t.attr("value",info[1]);
    t.attr("rank",info[0]);
    t.find(".name").text(info[1]);
    t.find(".age").text("("+info[2]+")");
    t.find(".point").text(info[3]);
    //t.removeClass(map[info[0]]);


}
$(document).ready(function(){
    $("#click").hide();
    $("#auto").click(function(){
        $("#click").hide();
        var timer;
        timer = setInterval(function(){if(cur < max) $("#click").click(); else clearInterval(timer);},500);
    });
    $("#click").click(function(){
        $("#auto").hide();
        detail = rank[cur].split(',');
        $("#date").text(detail[0]);
        for(var i = 1; i < 11;i++){
            if (cur == 0)  setup(detail[i]);
            else {
                //console.log(i);
                update(detail[i]);
            }
        }
        if(cur != 0) reorder();
        cur ++;
        //cur = cur % max;
        
    });
});

</script>
</body></html>